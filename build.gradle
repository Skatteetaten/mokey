buildscript {
  ext.kotlin_version = '1.2.30'
  ext.repos = {
    maven {
      url "http://repo1.maven.org/maven2"
    }

    maven {
      url "http://jcenter.bintray.com/"
    }

    mavenLocal()
  }

  repositories repos

  dependencies {
    classpath(
        "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version",
        "org.jetbrains.kotlin:kotlin-noarg:$kotlin_version",
        "org.jetbrains.kotlin:kotlin-allopen:$kotlin_version",
        'org.springframework.boot:spring-boot-gradle-plugin:2.0.0.RELEASE',
        'no.skatteetaten.aurora.gradle.plugins:aurora-gradle-plugin:1.2.1',
    )
  }
}

ext.aurora = [
    requireStaging: false
]

apply plugin: 'no.skatteetaten.plugins.aurora'
apply plugin: 'kotlin'
apply plugin: 'kotlin-spring'
apply plugin: 'org.springframework.boot'
apply plugin: 'io.spring.dependency-management'

repositories repos

group = 'no.skatteetaten.aurora'

dependencies {

  compile(
      "org.jetbrains.kotlin:kotlin-reflect:$kotlin_version",
      'org.jetbrains.kotlin:kotlin-stdlib-jdk8',
      'com.fasterxml.jackson.module:jackson-module-kotlin',
      "no.skatteetaten.aurora.springboot:aurora-spring-boot2-starter:1.1.0",
      'io.fabric8:openshift-client:3.1.8',
      'io.fabric8:kubernetes-model:2.0.4',
      "org.springframework.retry:spring-retry",
      'org.jetbrains.kotlinx:kotlinx-coroutines-core:0.21.2',
      'org.springframework.boot:spring-boot-starter-security'
  )

  testCompile(
      'org.springframework.restdocs:spring-restdocs-mockmvc',
      'org.springframework.security:spring-security-test',
      'org.junit.jupiter:junit-jupiter-api:5.1.0',
      'io.fabric8:openshift-server-mock:3.1.8',
      'org.springframework.boot:spring-boot-starter-test',
      'io.mockk:mockk:1.7.10'
  )

  testRuntime('org.junit.jupiter:junit-jupiter-engine:5.1.0')

}

springBoot {
  buildInfo()
}

compileKotlin {
  kotlinOptions {
    suppressWarnings = true
    jvmTarget = 1.8
  }
}

task wrapper(type: Wrapper) {
  gradleVersion = '4.6'
}

test {
  useJUnitPlatform()
}

kotlin {
  experimental {
    coroutines "enable"
  }
}
